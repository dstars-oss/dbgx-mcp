# windbg-mcp-debug-observability 规范

## 目的
定义 WinDbg MCP 调试链路的请求级关联与生命周期日志可观测性要求，确保在成功、失败与阻塞场景下可快速定位问题阶段。

## 需求
### 需求:WinDbg 调试日志必须提供请求级关联能力
系统必须为每个 MCP 请求在 WinDbg 输出中提供可关联的请求标识，用于串联同一请求在不同阶段的日志记录。

#### 场景:请求包含 JSON-RPC id 时可直接关联
- **当** 客户端发送包含 `id` 的 JSON-RPC 请求
- **那么** 系统必须在该请求相关的阶段日志中稳定输出同一 `rpc_id`

#### 场景:请求缺少 JSON-RPC id 时仍可关联
- **当** 客户端发送通知类请求或请求中缺少 `id`
- **那么** 系统必须输出进程内可追踪的本地关联标识
- **并且** 该标识必须在该请求生命周期内保持一致

### 需求:WinDbg 调试日志必须覆盖关键生命周期阶段
系统必须在请求处理链路的关键节点输出阶段日志，至少覆盖接收、执行开始、执行结束/失败与响应发送阶段。

#### 场景:工具调用成功时形成完整阶段链路
- **当** 客户端成功调用 `tools/call`
- **那么** 系统必须输出可读的阶段序列日志
- **并且** 日志中必须包含 `stage`、`outcome` 与 `duration_ms` 等排障字段

#### 场景:工具调用失败时保留失败阶段上下文
- **当** `tools/call` 因参数错误或执行失败返回错误结果
- **那么** 系统必须输出失败阶段日志并包含错误摘要
- **并且** 系统禁止将失败请求记录为成功结果
