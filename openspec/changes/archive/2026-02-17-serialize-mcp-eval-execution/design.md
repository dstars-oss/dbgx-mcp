## 上下文

当前 `windbg.eval` 的工具定义由 `src/mcp/json_rpc.cpp` 在 `tools/list` 响应中内联构造。虽然服务端已有互斥执行路径，但返回给 AI 客户端的元数据未明确表达“命令存在顺序依赖，应串行调用”，导致部分客户端可能尝试并发发起多个 `tools/call`，在调试会话中产生上下文错位。

本变更聚焦“协议可见提示”层面：让 MCP 工具元数据对 AI 明确给出串行约束，并通过自动化测试保证该提示不被后续改动意外移除。

## 目标 / 非目标

**目标：**
- 在 `windbg.eval` 工具元数据中明确声明：必须串行执行，必须等待上一条 `tools/call` 完成后再发送下一条。
- 保持现有 MCP 方法、工具名、输入 Schema 结构与返回语义兼容。
- 为串行提示增加可回归的测试断言，避免文案约束回退。

**非目标：**
- 不新增 MCP 方法或新的工具能力。
- 不引入新的参数字段（如 `sequenceId`、`sessionId`）来实现调度协议。
- 不在本次变更中重构 HTTP 并发模型或命令执行器实现。

## 决策

### 决策 1：串行约束以工具元数据文本形式暴露
- 方案：在 `tools/list` 的 `windbg.eval.description` 以及 `inputSchema.properties.command.description` 中加入一致的串行执行提示。
- 原因：这两处均是主流 MCP 客户端生成工具使用提示时最常读取的信息，改动小且可立即生效。
- 备选方案：
  - 新增自定义扩展字段（如 `x-execution-mode=serial`）。问题：客户端兼容性不一致，短期收益不稳定。
  - 仅更新 README。问题：AI 客户端运行时通常不会读取仓库文档，约束无法稳定传达。

### 决策 2：兼容优先，不改变输入契约
- 方案：保持 `windbg.eval` 输入仍只要求 `command`，通过描述强化调用顺序要求。
- 原因：避免对现有客户端造成 BREAKING 影响，同时满足“优化 MCP 返回提示”的核心诉求。
- 备选方案：
  - 强制新增必填调度参数。问题：会破坏已有调用方并增加迁移成本。

### 决策 3：用双层测试锁定串行提示
- 方案：同时更新 `tests/unit_tests.cpp`（字符串级断言）与 `tests/mcp_output_spec_test.py`（JSON 结构断言），验证 `tools/list` 中串行提示存在。
- 原因：单一测试层容易漏检；双层覆盖可兼顾快速回归与端到端输出契约。
- 备选方案：
  - 仅保留单元测试。问题：可能遗漏运行时序列化后的 JSON 字段表现差异。

## 风险 / 权衡

- [部分 MCP 客户端忽略 description 文本] -> 通过在工具与参数两处重复约束提高被采纳概率，并保持服务端既有互斥保护。
- [提示文案过长影响 token 使用] -> 保持短句、动作导向文案，仅强调“逐条执行 + 等待完成”。
- [未来文案改写导致约束弱化] -> 测试断言聚焦关键关键词（如 serial/逐条/等待上一条完成），减少语义漂移风险。

## 迁移计划

1. 修改 `src/mcp/json_rpc.cpp` 中 `windbg.eval` 的描述文案，加入串行执行提示。
2. 更新 `tests/unit_tests.cpp` 与 `tests/mcp_output_spec_test.py`，新增/增强串行约束断言。
3. 运行现有测试命令，确认 JSON-RPC 输出契约与工具调用路径无回归。
4. 若提示文案引发兼容问题，可仅回滚文案改动，不影响核心执行逻辑与接口结构。

## 待决问题

- 是否需要在后续迭代引入结构化执行语义字段（例如 `executionMode: serial`）以降低对自然语言提示的依赖。
